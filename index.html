<!doctype html>
<html>

<head>
  <meta charset="UTF-8">
  <title>POM - SYD</title>
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro&display=swap" rel="stylesheet">
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <!-- <script>
        $(document).ready(function(){
            $(pois).load("load-data.php");
        });
    </script> -->
  <link rel="shortcut icon" type="image/png" href="https://i.imgur.com/kIIQ8kl.png">
  <style>

    a {
      text-decoration: none;
      color: #2E95EE;
    }

    a:hover {
      text-decoration: underline;
    }

    body {
      font-family:'Source Sans Pro', sans-serif;
    }

    #block-wrp {
      width: 100%;
      display: flex;
      display: -webkit-flex;
      flex-wrap: wrap;
    }

    #block-wrp .block-item {
      height: 95vh;
      width: 50%;
      position: relative;
      display: flex;
      display: -webkit-flex;
      flex-direction: column;
      -webkit-flex-direction: column
    }

    #block-wrp .block-item .map-item {
      height: 100%;
      border: 10px solid #fff;

    }

    #block-wrp .block-item span.city-name {
      text-align: center;
      color: #000;
      text-transform: uppercase;
      font-weight: bold;
      font-family: Helvetica;
      background: #fff;
      height: 5%;
      line-height: 2em;

    }
  </style>
</head>

<body>

  <div id="block-wrp">
    <div class="block-item">
      <div id="mapCanvas1" class="map-item"> </div>
      <span class="city-name"><a href='https://en.wikipedia.org/wiki/Portsmouth'>Portsmouth, United Kingdom</a></span>
    </div>
    <div class="block-item">
      <div id="mapCanvas2" class="map-item"> </div>
      <span class="city-name"><a href='https://en.wikipedia.org/wiki/City_of_Sydney'>Sydney, Australia</a></span>
    </div>
  </div>

  <script type="text/javascript">

    //Get data from PHP
    var pois = [];
      $.get("load-data.php").done(function (data){
        data = data.substring(2, data.length -2);
  
        pois = data.split("],[");
        pois = pois.map(elem => elem.replace(/\"/g, ""));

        pois = pois.map(elem => elem.split(/,{1}(?=[^_|\s])/g)); //Result is an
        console.log(pois);

      });

    var cities = [];
      $.get("load-data copy.php").done(function (data) {
        data = data.substring(2, data.length - 2);

        cities = data.split("],[");
        cities = cities.map(elem => elem.replace(/\"/g, ""));
        cities = cities.map(elem => elem.split(","));
        console.log(cities);
      });
      

    var map1, map2;
    
    // Stylings to make the maps blank
    var myStyle = [
         {
           featureType: "administrative",
           elementType: "labels",
           stylers: [
             { visibility: "off" }
           ]
         },{
           featureType: "poi",
           elementType: "labels",
           stylers: [
             { visibility: "off" }
           ]
         },{
           featureType: "water",
           elementType: "labels",
           stylers: [
             { visibility: "off" }
           ]
         },{
           featureType: "road",
           elementType: "labels",
           stylers: [
             { visibility: "off" }
           ]
         }
       ];

    var myStyleTest = [
  {
    "elementType": "labels",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "administrative.neighborhood",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  }
];
    

    function drawMap() {
      setTimeout(function (){
      var infoWindowSingle = new google.maps.InfoWindow;

      var mapOptions = {
        zoom: 13,
        mapTypeControl: false,
        fullscreenControl: false,
        gestureHandling: 'none',
        zoomControl: false,
        streetViewControl:false,
        keyboardShortcuts: false
      }

      portsmouthCenter = new google.maps.LatLng(50.805832, -1.087222);
      sydneyCenter = new google.maps.LatLng(-33.865143, 151.209900);

      mapOptions.center = new google.maps.LatLng(cities[0][4], cities[0][5]); // Portsmouth
      map1 = new google.maps.Map(document.getElementById("mapCanvas1"), mapOptions);

      mapOptions.center = new google.maps.LatLng(cities[1][4],cities[1][5]); // Sydney
      map2 = new google.maps.Map(document.getElementById("mapCanvas2"), mapOptions);

      map1.set('styles', myStyleTest); //Apply the stylings to make the maps blank
      map2.set('styles', myStyleTest);

      // Listen for click on map
      google.maps.event.addListener(map1, 'click', function(event){
        // Add marker
        addMarker({coords:event.latLng});
      });

      // Listen for click on map
      google.maps.event.addListener(map2, 'click', function(event){
        // Add marker
        addMarker({coords:event.latLng});
      });

      
        
      
      var markerstest = [];
      var index;

      for(index = 0; index < pois.length; index++) {
        var tempMarker = {
          coords: {
            lat : parseFloat(pois[index][2]),
            lng : parseFloat(pois[index][3])
          },
          map : (pois[index][7] == "por" ? map1 : map2),
          
          content: pois[index][1]
        };
        markerstest.push(tempMarker);
      };

      console.log(markerstest);


      // Loop through markers
      console.log(markerstest.length);
      for (var i = 0; i < markerstest.length; i++) {
        // Add marker
        addMarker(markerstest[i]);
        console.log(markerstest[i]);
      }

      function addMarker(props) {
        var marker = new google.maps.Marker({
          position: props.coords,
          map: props.map,
        });

        // Check for customicond
        if (props.iconImage) {
          // Set icon image
          marker.setIcon(props.iconImage);
        }

        // Click on the marker to show the POI's name and image
        if (props.content) {

          marker.addListener('click', function(){
            infoWindowSingle.setContent("<div style='float:left'><img src='https://i.imgur.com/5xzPg3f.png' style='width:50px;'></div><div style='float:right;padding: 5px;'>"+props.content+"</div>");
            infoWindowSingle.open(map2, marker);
          });
          

          marker.addListener('click', function(){
            infoWindowSingle.setContent("<div style='float:left'><img src='https://i.imgur.com/5xzPg3f.png' style='width:50px;'></div><div style='float:right;padding: 5px;'>"+props.content+"</div>");
            infoWindowSingle.open(map1, marker);
          });
          

        }
      }
    
    }, 0);
    }
  </script>

  <script async defer src="https://maps.google.com/maps/api/js?key=AIzaSyDHj25MUPt4n2aLHslXKQs4GOHy9wdH5_0&callback=drawMap"></script>
  

</body>

</html>
